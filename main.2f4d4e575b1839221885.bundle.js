(()=>{"use strict";const t={multiply:function(t,e){let s=t[0],i=t[1],n=t[2],h=t[3],r=t[4],o=t[5],a=t[6],c=t[7],l=t[8],d=e[0],g=e[1],u=e[2],p=e[3],L=e[4],w=e[5],I=e[6],E=e[7],T=e[8];return[d*s+g*h+u*a,d*i+g*r+u*c,d*n+g*o+u*l,p*s+L*h+w*a,p*i+L*r+w*c,p*n+L*o+w*l,I*s+E*h+T*a,I*i+E*r+T*c,I*n+E*o+T*l]},translation:function(t,e){return[1,0,0,0,1,0,t,e,1]},rotation:function(t){let e=Math.cos(t),s=Math.sin(t);return[e,-s,0,s,e,0,0,0,1]},scaling:function(t,e){return[t,0,0,0,e,0,0,0,1]},projection:function(t,e){return[2/t,0,0,0,-2/e,0,-1,1,1]},translate:function(e,s,i){return t.multiply(e,t.translation(s,i))},rotate:function(e,s){return t.multiply(e,t.rotation(s))},scale:function(e,s,i){return t.multiply(e,t.scaling(s,i))}},e={translation:function(t,e,s){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,s,1]},xRotation:function(t){let e=Math.cos(t),s=Math.sin(t);return[1,0,0,0,0,e,s,0,0,-s,e,0,0,0,0,1]},yRotation:function(t){let e=Math.cos(t),s=Math.sin(t);return[e,0,-s,0,0,1,0,0,s,0,e,0,0,0,0,1]},zRotation:function(t){let e=Math.cos(t),s=Math.sin(t);return[e,s,0,0,-s,e,0,0,0,0,1,0,0,0,0,1]},scaling:function(t,e,s){return[t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1]},translate:function(t,s,i,n){return e.multiply(t,e.translation(s,i,n))},xRotate:function(t,s){return e.multiply(t,e.xRotation(s))},yRotate:function(t,s){return e.multiply(t,e.yRotation(s))},zRotate:function(t,s){return e.multiply(t,e.zRotation(s))},scale:function(t,s,i,n){return e.multiply(t,e.scaling(s,i,n))},multiply:function(t,e){let s=e[0],i=e[1],n=e[2],h=e[3],r=e[4],o=e[5],a=e[6],c=e[7],l=e[8],d=e[9],g=e[10],u=e[11],p=e[12],L=e[13],w=e[14],I=e[15],E=t[0],T=t[1],_=t[2],S=t[3],f=t[4],R=t[5],A=t[6],x=t[7],C=t[8],O=t[9],y=t[10],j=t[11],v=t[12],X=t[13],b=t[14],m=t[15];return[s*E+i*f+n*C+h*v,s*T+i*R+n*O+h*X,s*_+i*A+n*y+h*b,s*S+i*x+n*j+h*m,r*E+o*f+a*C+c*v,r*T+o*R+a*O+c*X,r*_+o*A+a*y+c*b,r*S+o*x+a*j+c*m,l*E+d*f+g*C+u*v,l*T+d*R+g*O+u*X,l*_+d*A+g*y+u*b,l*S+d*x+g*j+u*m,p*E+L*f+w*C+I*v,p*T+L*R+w*O+I*X,p*_+L*A+w*y+I*b,p*S+L*x+w*j+I*m]},projection:function(t,e,s){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/s,0,-1,1,0,1]},orthographic:function(t,e,s,i,n,h){return[2/(e-t),0,0,0,0,2/(i-s),0,0,0,0,2/(n-h),0,(t+e)/(t-e),(s+i)/(s-i),(n+h)/(n-h),1]}},s={m3:t,m4:e,createShader:function(t,e,s){const i=t.createShader(e);if(i){if(t.shaderSource(i,s),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;console.log(t.getShaderInfoLog(i)),t.deleteShader(i)}},createProgram:function(t,e,s){const i=t.createProgram();if(i){if(t.attachShader(i,e),t.attachShader(i,s),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS))return i;console.log(t.getProgramInfoLog(i)),t.deleteProgram(i)}}};class i{constructor(t){const e=t.getContext("webgl");if(e){this.gl=e,this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.vertexSource="\nattribute vec4 a_position;\nattribute vec2 a_texcoord;\n\nuniform mat4 u_matrix;\nuniform mat4 u_textureMatrix;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    gl_Position = u_matrix * a_position;\n    v_texcoord = (u_textureMatrix * vec4(a_texcoord, 0, 1)).xy;\n}\n",this.fragmentSource="\nprecision mediump float;\n\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\n\nvoid main() {\n    gl_FragColor = texture2D(u_texture, v_texcoord);\n}\n";let t=s.createShader(this.gl,this.gl.VERTEX_SHADER,this.vertexSource),i=s.createShader(this.gl,this.gl.FRAGMENT_SHADER,this.fragmentSource);if(t&&i){const e=s.createProgram(this.gl,t,i);e&&(this.program=e)}this.positionLocation=this.gl.getAttribLocation(this.program,"a_position"),this.texcoordLocation=this.gl.getAttribLocation(this.program,"a_texcoord");const n=this.gl.getUniformLocation(this.program,"u_matrix");n&&(this.matrixLocation=n);const h=this.gl.getUniformLocation(this.program,"u_textureMatrix");h&&(this.textureMatrixLocation=h);const r=this.gl.getUniformLocation(this.program,"u_texture");r&&(this.textureLocation=r);const o=this.gl.createBuffer();o&&(this.positionBuffer=o);const a=this.gl.createBuffer();a&&(this.texcoordBuffer=a)}}static init(t){this.canvas=t}static getInstance(){return this.instance||(this.instance=new i(i.canvas)),this.instance}loadImageAndCreateTextureInfo(t){const e=this.gl.createTexture();if(e){this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR);let s={width:1,height:1,texture:e},i=new Image;return i.addEventListener("load",(t=>{s.width=i.width,s.height=i.height,this.gl&&(this.gl.bindTexture(this.gl.TEXTURE_2D,s.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i))})),i.src=t,s}return{width:0,height:0,texture:WebGLTexture}}draw(t,e,s,i,n,h,r,o,a){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),this.gl.STATIC_DRAW),this.drawImage(t.texture,t.width,t.height,e,s,i,n,h,r,o,a)}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}drawImage(t,e,i,n,h,r,o,a,c,l,d){if(this.gl){this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),this.gl.enableVertexAttribArray(this.texcoordLocation),this.gl.vertexAttribPointer(this.texcoordLocation,2,this.gl.FLOAT,!1,0,0);let g=s.m4.orthographic(0,this.gl.canvas.width,this.gl.canvas.height,0,-1,1);g=s.m4.translate(g,a,c,0),g=s.m4.scale(g,l,d,1),this.gl.uniformMatrix4fv(this.matrixLocation,!1,g);let u=s.m4.translation(n/e,h/i,0);u=s.m4.scale(u,r/e,o/i,1),this.gl.uniformMatrix4fv(this.textureMatrixLocation,!1,u),this.gl.uniform1i(this.textureLocation,0),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}}}const n=i;class h{constructor(){this.canvas=document.createElement("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.sceneList=[],n.init(this.canvas)}static getInstance(){return this.instance||(this.instance=new h),this.instance}handleInput(t){this.sceneList.forEach((e=>{e.handleInput(t)}))}update(t){this.sceneList.forEach((e=>{e.update(t)}))}render(){n.getInstance().clear(),this.sceneList.forEach((t=>{t.render()})),document.body.appendChild(this.canvas)}addScene(t){this.sceneList.push(t)}setSceneWidth(t){this.canvas.width=t}setSceneHeight(t){this.canvas.height=t}reloadScene(t){t>=0&&t<this.sceneList.length&&(this.sceneList[t].setIsRendered(!0),this.sceneList[t].setIsUpdated(!0),this.sceneList[t].reload())}startScene(t){t>=0&&t<this.sceneList.length&&(this.sceneList[t].setIsRendered(!0),this.sceneList[t].setIsUpdated(!0),this.sceneList[t].reload())}stopScene(t){t>=0&&t<this.sceneList.length&&(this.sceneList[t].setIsRendered(!1),this.sceneList[t].setIsUpdated(!1))}pauseScene(t){t>=0&&t<this.sceneList.length&&this.sceneList[t].setIsUpdated(!1)}resumeScene(t){t>=0&&t<this.sceneList.length&&this.sceneList[t].setIsUpdated(!0)}}const r=h,o=class{constructor(t){this.event=t}getEvent(){return this.event}};class a{constructor(){this.mouseEventList=[],this.keyboardEventList=[]}register(t){this.scene=t}static getInstance(){return this.instance||(this.instance=new a),this.instance}attachMouseEvent(t){this.mouseEventList.push(t)}attachKeyboardEvent(t){this.keyboardEventList.push(t)}detach(t){let e=this.mouseEventList.indexOf(t);e>-1&&this.mouseEventList.splice(e,1),e=this.keyboardEventList.indexOf(t),e>-1&&this.keyboardEventList.splice(e,1)}notify(t){t instanceof KeyboardEvent?this.keyboardEventList.forEach((e=>{e.handleInput(new o(t))})):t instanceof MouseEvent&&this.mouseEventList.forEach((e=>{e.handleInput(new o(t))}))}addEventListener(t){document.addEventListener(t,(t=>{t.preventDefault(),this.notify(t)}),!1)}}const c=a;class l{constructor(){this.rigidBodyList=[]}static getInstance(){return this.instance||(this.instance=new l),this.instance}setAccelerationX(t){this.accelerationX=t}setAccelerationY(t){this.accelerationY=t}attach(t){this.rigidBodyList.push(t)}detach(t){const e=this.rigidBodyList.indexOf(t);e>-1&&this.rigidBodyList.splice(e,1)}update(t){let e=t/1e3;this.rigidBodyList.forEach((t=>{t.getPhysicsEffect()&&(t.getAccelerationEffect()?(t.setShiftX(Math.floor(.5*this.accelerationX*e*e+t.getVelocityX()*e)),t.setShiftY(Math.floor(.5*this.accelerationY*e*e+t.getVelocityY()*e)),t.setVelocityX(Math.floor(t.getVelocityX()+this.accelerationX*e)),t.setVelocityY(Math.floor(t.getVelocityY()+this.accelerationY*e))):(t.setShiftX(Math.floor(t.getVelocityX()*e)),t.setShiftY(Math.floor(t.getVelocityY()*e))))}))}}const d=l;class g{constructor(){this.texList=[]}static getInstance(){return this.instance||(this.instance=new g),this.instance}loadImage(t){let e=n.getInstance().loadImageAndCreateTextureInfo("assets/images/"+t);this.texList.push(e)}getTex(t){return t>=0&&t<this.texList.length?this.texList[t]:this.texList[0]}}const u=g,p=class{constructor(){this.inputHandler=c.getInstance(),this.sceneManager=r.getInstance(),this.physicsManager=d.getInstance(),this.resourceManager=u.getInstance(),this.lastTime=window.performance.now(),this.setup()}update(){let t=window.performance.now();this.physicsManager.update(t-this.lastTime),this.sceneManager.update(t-this.lastTime),this.lastTime=t}render(){this.sceneManager.render()}run(){this.update(),this.render(),requestAnimationFrame((()=>{this.run()}))}};class L{constructor(t,e){this.x=t,this.y=e}getX(){return this.x}setX(t){this.x=t}getY(){return this.y}setY(t){this.y=t}add(t){let e=new L(0,0);return e.setX(this.x+t.getX()),e.setY(this.y+t.getY()),e}sub(t){let e=new L(0,0);return e.setX(this.x-t.getX()),e.setY(this.y-t.getY()),e}assign(t){this.x=t.getX(),this.y=t.getY()}copy(){return new L(this.x,this.y)}}const w=L,I={VELOCITY_CHANGING_INTERVAL:1e3,TREX_VELOCITY_X:0,TREX_VELOCITY_Y:0,TREX_JUMPING_VELOCITY:600,TREX_JUMPING_ACCESSLATION:-2e3,TREX_CANVAS_LOCATION:new w(100,260),TREX_CHANGING_INTERVAL:100,OBSTACLE_GENERATING_INTERVAL:2e3,CACTUS_VELOCITY_X:450,CACTUS_VELOCITY_Y:0,CACTUS_CANVAS_LOCATION:new w(1500,257),BIRD_VELOCITY_X:450,BIRD_VELOCITY_Y:0,BIRD_HIGH_CANVAS_LOCATION:new w(1500,242),BIRD_LOW_CANVAS_LOCATION:new w(1500,267),BIRD_CHANGING_INTERVAL:300,GROUND_VELOCITY_X:450,GROUND_VELOCITY_Y:0,GROUND_CANVAS_LOCATION:new w(0,292),CLOUD_VELOCITY_X:200,CLOUD_VELOCITY_Y:0,CLOUD_CANVAS_LOCATION:new w(1500,132),CLOUD_GENERATING_INTERVAL:3e3,CLOUD_LOW_Y:162,CLOUD_HIGH_Y:238,SCOREBOARD_CANVAS_LOCATION:new w(1e3,82),SCOREBOARD_SCORE_CHANGING_INTERVAL:100},E=class{constructor(){this.objectList=[],this.toAddObjectList=[],this.toRemoveObjectList=[],this.inputHandler=c.getInstance(),this.isUpdated=!0,this.isRendered=!0,this.setup()}getState(){return this.state}setState(t){this.state=t}render(){this.synchronize(),this.isRendered&&this.objectList.forEach((t=>{t.render()}))}update(t){this.isUpdated&&this.objectList.forEach((e=>{e.update(t)}))}synchronize(){let t;this.toAddObjectList.forEach((t=>{this.objectList.push(t)})),this.objectList.sort(((t,e)=>t.getZIndex()>e.getZIndex()?1:t.getZIndex()<e.getZIndex()?-1:0)),this.toAddObjectList.length=0,this.toRemoveObjectList.forEach((e=>{t=this.objectList.indexOf(e),t>-1&&this.objectList.splice(t,1)})),this.toRemoveObjectList.length=0}addObject(t){this.toAddObjectList.push(t),t.attachScene(this)}removeObject(t){this.toRemoveObjectList.push(t)}getObjectList(){return this.objectList}setObjectList(t){this.objectList=t}clearObjectList(){this.objectList.length=0}pause(){this.isUpdated=!1}resume(){this.isUpdated=!0}stop(){this.isUpdated=!1,this.isRendered=!1}start(){this.reload(),this.isUpdated=!0,this.isRendered=!0}getIsRendered(){return this.isRendered}setIsRendered(t){this.isRendered=t}getIsUpdated(){return this.isUpdated}setIsUpdated(t){this.isUpdated=t}},T=class{constructor(t,e,s){this.velocityX=t,this.velocityY=e,this.mass=s,this.accelerationEffect=!1,this.physicsEffect=!0,this.shiftX=0,this.shiftY=0,d.getInstance().attach(this)}getVelocityX(){return this.velocityX}getVelocityY(){return this.velocityY}setVelocityX(t){this.velocityX=t}setVelocityY(t){this.velocityY=t}getMass(){return this.mass}setMass(t){this.mass=t}getAccelerationEffect(){return this.accelerationEffect}setAccelerationEffect(t){this.accelerationEffect=t}getPhysicsEffect(){return this.physicsEffect}setPhysicsEffect(t){this.physicsEffect=t}getShiftX(){return this.shiftX}setShiftX(t){this.shiftX=t}getShiftY(){return this.shiftY}setShiftY(t){this.shiftY=t}},_=class{constructor(t,e){this.location=t.copy(),this.colliderList=[],this.rigidBody=new T(0,0,0),this.inputHandler=c.getInstance(),this.sceneManager=r.getInstance(),this.physicsManager=d.getInstance(),this.resourceManager=u.getInstance(),this.zIndex=e||0,this.isRendered=!0,this.isDestroyed=!1}getLocation(){return this.location}setLocation(t){this.location=t.copy()}getX(){return this.location.getX()}setX(t){this.location.setX(t)}getY(){return this.location.getY()}setY(t){this.location.setY(t)}getZIndex(){return this.zIndex}setZIndex(t){this.zIndex=t}getIsRendered(){return this.isRendered}setIsRendered(t){this.isRendered=t}getState(){return this.state}setState(t){this.state=t}handleInputState(t){this.state.handleInput(this,t)}updateState(t){this.state.update(this,t)}getColliderList(){return this.colliderList}setColliderList(t){this.colliderList=t}addCollider(t){this.colliderList.push(t)}clearColliderList(){this.colliderList.length=0}getVelocityX(){return this.rigidBody.getVelocityX()}setVelocityX(t){this.rigidBody.setVelocityX(t)}getVelocityY(){return this.rigidBody.getVelocityY()}setVelocityY(t){this.rigidBody.setVelocityY(t)}getShiftX(){return this.rigidBody.getShiftX()}getShiftY(){return this.rigidBody.getShiftY()}getMass(){return this.rigidBody.getMass()}setMass(t){this.rigidBody.setMass(t)}setAccelerationEffect(t){this.rigidBody.setAccelerationEffect(t)}setPhysicsEffect(t){this.rigidBody.setPhysicsEffect(t)}attachScene(t){this.scene=t}getScene(){return this.scene}getTex(){return this.tex}setTex(t){this.tex=t}isColliedWith(t){for(let e=0;e<this.colliderList.length;e++)for(let s=0;s<t.colliderList.length;s++){let i,n,h,r;if(i=this.colliderList[e].getOrigin(),i=i.add(this.location),n=new w(i.getX()+this.colliderList[e].getWidth(),i.getY()+this.colliderList[e].getHeight()),h=t.colliderList[s].getOrigin(),h=h.add(t.location),r=new w(h.getX()+t.colliderList[s].getWidth(),h.getY()+t.colliderList[s].getHeight()),!(n.getX()-h.getX()<=-2||r.getX()-i.getX()<=-2||n.getY()-h.getY()<=-2||r.getY()-i.getY()<=-2))return!0}return!1}destroy(){this.inputHandler.detach(this),this.physicsManager.detach(this.rigidBody),this.isDestroyed=!0}getIsDestroyed(){return this.isDestroyed}handleInput(t){}update(t){}render(){}},S=class extends _{constructor(t,e){e?super(t,e):super(t),this.spriteList=[],this.content="",this.letterGap=1}render(){if(this.getIsRendered()){const t=n.getInstance();let e=0;this.spriteList.forEach((s=>{t.draw(this.getTex(),s.coor.getX(),s.coor.getY(),s.width,s.height,this.getX()+e,this.getY(),s.width*s.scale,s.height*s.scale),e+=s.width*s.scale+this.letterGap}))}}getContent(){return this.content}setContent(t){this.content=t,this.contentToSpriteList()}},f={CLOUD_SPRITE:{clip:{coor:new w(164,0),width:96,height:32,scale:.5},adjust:new w(0,0)},BIRD_SPRITE:[{clip:{coor:new w(262,16),width:88,height:64,scale:.5},adjust:new w(0,0)},{clip:{coor:new w(354,4),width:88,height:56,scale:.5},adjust:new w(0,-4)}],CACTUS_SPRITES:[{clip:{coor:new w(446,2),width:34,height:70,scale:.5},adjust:new w(0,14)},{clip:{coor:new w(480,2),width:68,height:70,scale:.5},adjust:new w(0,14)},{clip:{coor:new w(548,2),width:102,height:70,scale:.5},adjust:new w(0,14)},{clip:{coor:new w(652,2),width:50,height:100,scale:.5},adjust:new w(0,0)},{clip:{coor:new w(702,2),width:48,height:100,scale:.5},adjust:new w(0,0)},{clip:{coor:new w(752,2),width:98,height:100,scale:.5},adjust:new w(0,0)},{clip:{coor:new w(850,2),width:102,height:100,scale:.5},adjust:new w(0,0)}],TREX_SPRITES:[{clip:{coor:new w(1516,4),width:84,height:90,scale:.5},adjust:new w(0,0)},{clip:{coor:new w(1604,4),width:84,height:90,scale:.5},adjust:new w(0,0)},{clip:{coor:new w(1868,38),width:114,height:56,scale:.5},adjust:new w(0,16)},{clip:{coor:new w(1986,38),width:114,height:56,scale:.5},adjust:new w(0,16)},{clip:{coor:new w(1340,4),width:84,height:90,scale:.5},adjust:new w(0,0)},{clip:{coor:new w(1428,4),width:84,height:90,scale:.5},adjust:new w(0,0)},{clip:{coor:new w(1692,4),width:84,height:90,scale:.5},adjust:new w(0,0)},{clip:{coor:new w(78,6),width:88,height:92,scale:.5},adjust:new w(0,0)}],GROUND_SPRITE:{clip:{coor:new w(0,102),width:2404,height:28,scale:.5},adjust:new w(0,0)},NUMBER_SPRITES:{0:{clip:{coor:new w(952,0),width:22,height:26,scale:.5},adjust:new w(0,0)},1:{clip:{coor:new w(974,0),width:20,height:26,scale:.5},adjust:new w(0,0)},2:{clip:{coor:new w(992,0),width:22,height:26,scale:.5},adjust:new w(0,0)},3:{clip:{coor:new w(1012,0),width:22,height:26,scale:.5},adjust:new w(0,0)},4:{clip:{coor:new w(1032,0),width:22,height:26,scale:.5},adjust:new w(0,0)},5:{clip:{coor:new w(1052,0),width:22,height:26,scale:.5},adjust:new w(0,0)},6:{clip:{coor:new w(1072,0),width:22,height:26,scale:.5},adjust:new w(0,0)},7:{clip:{coor:new w(1092,0),width:22,height:26,scale:.5},adjust:new w(0,0)},8:{clip:{coor:new w(1112,0),width:22,height:26,scale:.5},adjust:new w(0,0)},9:{clip:{coor:new w(1132,0),width:22,height:26,scale:.5},adjust:new w(0,0)}},HI_SPRITE:{clip:{coor:new w(1152,0),width:42,height:26,scale:.5},adjust:new w(0,0)},GAMEOVER_SPRITE:{clip:{coor:new w(952,28),width:384,height:24,scale:.75},adjust:new w(0,0)},PLAY_BUTTON_SPRITE:{clip:{coor:new w(2,2),width:72,height:64,scale:.5},adjust:new w(0,0)}},R=class extends S{constructor(){super(new w(350,182)),this.setTex(this.resourceManager.getTex(0)),this.setContent("GAMEOVER")}handleInput(t){}update(t){}contentToSpriteList(){this.spriteList.length=0,this.spriteList.push(f.GAMEOVER_SPRITE.clip)}},A=class extends _{constructor(t,e,s){s?super(t,s):super(t),this.sprite=e}render(){this.getIsRendered()&&n.getInstance().draw(this.getTex(),this.sprite.coor.getX(),this.sprite.coor.getY(),this.sprite.width,this.sprite.height,this.getX(),this.getY(),this.sprite.width*this.sprite.scale,this.sprite.height*this.sprite.scale)}setSprite(t){this.sprite=t}getWidth(){return this.sprite.width*this.sprite.scale}getHeight(){return this.sprite.height*this.sprite.scale}},x=class extends A{constructor(t,e,s){s?super(t,e,s):super(t,e),this.callbackList=[],this.clicked=!0,this.isActive=!0,this.mouseDown=!0}handleInput(t){if(this.isActive){const e=t.getEvent();e instanceof Event&&e instanceof MouseEvent&&(e.x>=this.getLocation().getX()&&e.y>=this.getLocation().getY()&&e.x<=this.getLocation().getX()+this.getWidth()&&e.y<=this.getLocation().getY()+this.getHeight()?this.clicked?"mousedown"==e.type?this.mouseDown&&(this.mouseDown=!1):"mouseup"==e.type&&(this.mouseDown||this.callbackList.forEach((t=>{t()}))):this.callbackList.forEach((t=>{t()})):this.mouseDown=!0)}}setClicked(t){this.clicked=t}setActive(t){this.isActive=t}attach(t){this.callbackList.push(t)}},C=class extends x{constructor(t,e,s){s?super(t,e,s):super(t,e),this.setTex(this.resourceManager.getTex(0))}update(t){}},O=class extends E{constructor(){super()}handleInput(t){}reload(){this.replayButton.setActive(!0)}setup(){this.gameOver=new R,this.replayButton=new C(new w(480,230),f.PLAY_BUTTON_SPRITE.clip,2),this.inputHandler.attachMouseEvent(this.replayButton),this.replayButton.setActive(!0),this.replayButton.attach((()=>{this.replayButton.setActive(!1),this.stop(),r.getInstance().startScene(0)})),this.addObject(this.gameOver),this.addObject(this.replayButton)}},y=class extends S{constructor(t){super(new w(880,182)),this.setTex(this.resourceManager.getTex(0)),this.setContent("00000"),this.changingInterval=t}handleInput(t){}update(t){if(this.changingInterval-t<0){this.changingInterval=I.SCOREBOARD_SCORE_CHANGING_INTERVAL;let t=Number(this.getContent());t+=1;let e,s="";for(let i=4;i>-1;i--)e=Math.floor(t/10**i),t%=10**i,s+=String(e);this.setContent(s)}else this.changingInterval-=t}reload(){this.setContent("00000")}contentToSpriteList(){this.spriteList.length=0;for(let t=0;t<this.content.length;t++)this.spriteList.push(f.NUMBER_SPRITES[this.content[t]].clip)}},j=class extends S{constructor(){super(new w(785,182)),this.setTex(this.resourceManager.getTex(0)),this.setContent("00000"),window.localStorage.setItem("high_score",this.getContent())}handleInput(t){}update(t){}reload(){const t=window.localStorage.getItem("high_score");t?this.setContent(t):this.setContent("00000")}contentToSpriteList(){this.spriteList.length=0;for(let t=0;t<this.content.length;t++)this.spriteList.push(f.NUMBER_SPRITES[this.content[t]].clip)}},v=class extends S{constructor(){super(new w(750,182)),this.setTex(this.resourceManager.getTex(0)),this.setContent("HI")}handleInput(t){}update(t){}contentToSpriteList(){this.spriteList.length=0,this.spriteList.push(f.HI_SPRITE.clip)}},X=class extends _{constructor(t,e){e?super(t,e):super(t),this.highPoint=new j,this.currentPoint=new y(I.SCOREBOARD_SCORE_CHANGING_INTERVAL),this.HI=new v,this.isUpdated=!0}handleInput(t){}update(t){this.isUpdated&&(this.highPoint.update(t),this.currentPoint.update(t),this.HI.update(t),this.updateHighScore())}render(){this.getIsRendered()&&(this.highPoint.render(),this.currentPoint.render(),this.HI.render())}reload(){this.highPoint.reload(),this.currentPoint.reload()}setIsUpdated(t){this.isUpdated=t}updateHighScore(){Number(this.highPoint.getContent())<Number(this.currentPoint.getContent())&&window.localStorage.setItem("high_score",this.currentPoint.getContent())}},b=40,m=38,N=32,Y=class{constructor(){}},V=class{constructor(t,e,s){this.origin=t,this.width=e,this.height=s}getOrigin(){return this.origin}getWidth(){return this.width}getHeight(){return this.height}setOrigin(t){this.origin=t}setWidth(t){this.width=t}setHeight(t){this.height=t}},G=[f.TREX_SPRITES[0].clip,f.TREX_SPRITES[1].clip],U=[f.TREX_SPRITES[0].adjust,f.TREX_SPRITES[1].adjust],B=[new V(new w(20,0),22,12),new V(new w(10,11),27,21),new V(new w(10,32),15,12),new V(new w(0,15),12,10),new V(new w(5,25),7,10)],P=[B,B],D=[f.TREX_SPRITES[2].clip,f.TREX_SPRITES[3].clip],M=[f.TREX_SPRITES[2].adjust,f.TREX_SPRITES[3].adjust],H=[new V(new w(34,2),22,16),new V(new w(11,2),23,26),new V(new w(0,0),12,16)],W=[H,H],k=[f.TREX_SPRITES[4].clip],F=[f.TREX_SPRITES[4].adjust],J=[f.TREX_SPRITES[6].clip,f.TREX_SPRITES[7].clip],z=[f.TREX_SPRITES[6].adjust,f.TREX_SPRITES[7].adjust];class K extends Y{constructor(){super()}handleInput(t,e){const s=e.getEvent();s instanceof Event?s instanceof KeyboardEvent&&"keydown"==s.type&&(s.keyCode==b?(t.setState(new Z),t.setSpriteList(D),t.setAdjustList(M),t.setCollidersList(W)):s.keyCode!=N&&s.keyCode!=m||s.repeat||(t.setState(new q),t.setSpriteList(k),t.setAdjustList(F),t.setVelocityY(I.TREX_JUMPING_VELOCITY),t.setAccelerationEffect(!0))):"gameover"==s&&(t.setState(new Q),t.setSpriteList(J),t.setAdjustList(z))}update(t,e){t.animate(e)}}class Z extends Y{constructor(){super()}handleInput(t,e){const s=e.getEvent();s instanceof Event?s instanceof KeyboardEvent&&s.keyCode==b&&"keyup"==s.type&&(t.setState(new K),t.setSpriteList(G),t.setAdjustList(U),t.setCollidersList(P)):"gameover"==s&&(t.setState(new Q),t.setSpriteList(J),t.setAdjustList(z))}update(t,e){t.animate(e)}}class q extends Y{constructor(){super()}handleInput(t,e){"gameover"==e.getEvent()&&(t.setState(new Q),t.setSpriteList(J),t.setAdjustList(z))}update(t,e){t.animate(e);let s=t.getShiftY(),i=t.getLocation().copy();i.getY()-s>I.TREX_CANVAS_LOCATION.getY()||i.getY()<0?(i.setY(I.TREX_CANVAS_LOCATION.getY()),t.setSpriteList(G),t.setLocation(i),t.setVelocityY(0),t.setAccelerationEffect(!1),t.setState(new K)):(i.setY(i.getY()-s),t.setLocation(i))}}class Q extends Y{constructor(){super()}handleInput(t,e){"play"==e.getEvent()&&(t.setY(I.TREX_CANVAS_LOCATION.getY()),t.setState(new K),t.setSpriteList(G),t.setAdjustList(U),t.setCollidersList(P))}update(t,e){t.animate(e)}}const $=class extends Y{constructor(){super()}handleInput(t,e){const s=e.getEvent();s instanceof Event&&s instanceof KeyboardEvent&&(s.keyCode!=N&&s.keyCode!=m||s.repeat||(t.setState(new q),t.setSpriteList(k),t.setAdjustList(F),t.setCollidersList(P),t.setVelocityY(I.TREX_JUMPING_VELOCITY),t.setAccelerationEffect(!0),t.getScene().handleInput(new o("play"))))}update(t,e){t.animate(e)}},tt=class extends _{constructor(t,e,s,i){i?super(t,i):super(t),this.previousShift=new w(0,0),this.spriteList=s,this.adjustList=[],this.collidersList=[],this.changingInterval=e,this.remainingInterval=this.changingInterval,this.index=0}animate(t){this.spriteList.length>0&&(this.remainingInterval<0?(this.remainingInterval=this.changingInterval,this.setLocation(this.getLocation().sub(this.previousShift)),this.index=(this.index+1)%this.spriteList.length,this.index>=0&&this.index<this.adjustList.length&&(this.setLocation(this.getLocation().add(this.adjustList[this.index])),this.previousShift=this.adjustList[this.index]),this.index>=0&&this.index<this.collidersList.length&&this.setColliderList(this.collidersList[this.index])):this.remainingInterval-=t)}render(){if(this.getIsRendered()){const t=n.getInstance();if(this.spriteList.length>0){let e=this.getLocation();this.index>=0&&this.index<this.adjustList.length&&(e=e.add(this.adjustList[this.index])),t.draw(this.getTex(),this.spriteList[this.index].coor.getX(),this.spriteList[this.index].coor.getY(),this.spriteList[this.index].width,this.spriteList[this.index].height,this.getX(),this.getY(),this.spriteList[this.index].width*this.spriteList[this.index].scale,this.spriteList[this.index].height*this.spriteList[this.index].scale)}}}getCurrentSprite(){return this.spriteList[this.index]}setSpriteList(t){this.index=0,this.setLocation(this.getLocation().sub(this.previousShift)),this.index>=0&&this.index<this.adjustList.length&&(this.setLocation(this.getLocation().add(this.adjustList[this.index])),this.previousShift=this.adjustList[this.index]),this.spriteList=t}setAdjustList(t){this.adjustList=t,this.setLocation(this.getLocation().sub(this.previousShift)),this.index>=0&&this.index<this.adjustList.length&&(this.setLocation(this.getLocation().add(this.adjustList[this.index])),this.previousShift=this.adjustList[this.index])}setCollidersList(t){t.length>0&&this.setColliderList(t[0]),this.collidersList=t}getWidth(){return this.spriteList.length>0?this.spriteList[this.index].width*this.spriteList[this.index].scale:0}getHeight(){return this.spriteList.length>0?this.spriteList[this.index].height*this.spriteList[this.index].scale:0}},et=[f.TREX_SPRITES[7].clip],st=[f.TREX_SPRITES[7].adjust],it=class extends tt{constructor(t,e){e?super(t,I.TREX_CHANGING_INTERVAL,et,e):super(t,I.TREX_CHANGING_INTERVAL,et),this.setTex(this.resourceManager.getTex(0)),this.setState(new $),this.setAdjustList(st),this.onCollideWithDictionary={},this.onCollideWithList=[]}handleInput(t){this.handleInputState(t)}update(t){this.updateState(t),this.onCollideWithList.forEach((t=>{this.isColliedWith(t)&&this.onCollideWithDictionary[JSON.stringify(t)].forEach((t=>{t()}))}))}onCollideWith(t,e){this.onCollideWithDictionary[JSON.stringify(t)]||(this.onCollideWithDictionary[JSON.stringify(t)]=[]),this.onCollideWithDictionary[JSON.stringify(t)].push(e),this.onCollideWithList.indexOf(t)<0&&this.onCollideWithList.push(t)}},nt=function(t,e){let s=e-t+1;return Math.floor(Math.random()*s+t)},ht=[[new V(new w(1,9),10,14),new V(new w(6,5),10,10),new V(new w(6,1),6,10)],[new V(new w(1,9),10,14),new V(new w(23,5),10,10),new V(new w(6,1),22,10)],[new V(new w(1,9),10,14),new V(new w(40,5),10,10),new V(new w(6,1),39,10)],[new V(new w(1,13),10,14),new V(new w(14,11),10,10),new V(new w(9,1),7,14)],[new V(new w(1,13),10,14),new V(new w(14,11),10,10),new V(new w(9,1),7,14)],[new V(new w(1,6),10,20),new V(new w(38,12),10,20),new V(new w(9,1),32,14)],[new V(new w(1,17),10,18),new V(new w(38,12),12,20),new V(new w(7,1),35,16)]],rt=class extends A{constructor(t){let e=nt(0,6);super(t.add(f.CACTUS_SPRITES[e].adjust),f.CACTUS_SPRITES[e].clip),this.setTex(this.resourceManager.getTex(0)),this.setColliderList(ht[e]),this.setVelocityX(I.CACTUS_VELOCITY_X)}handleInput(t){}update(t){let e=this.getShiftX();this.setX(this.getX()-e)}},ot=[f.BIRD_SPRITE[0].clip,f.BIRD_SPRITE[1].clip],at=[f.BIRD_SPRITE[0].adjust,f.BIRD_SPRITE[1].adjust],ct=[[new V(new w(0,0),18,12),new V(new w(16,12),8,20),new V(new w(24,12),18,9)],[new V(new w(0,6),18,12),new V(new w(16,0),8,20),new V(new w(24,10),8,10),new V(new w(18,20),24,8)]],lt=class extends tt{constructor(t){super(t,I.BIRD_CHANGING_INTERVAL,ot),this.setAdjustList(at),this.setCollidersList(ct),this.setVelocityX(I.BIRD_VELOCITY_X),this.setTex(this.resourceManager.getTex(0))}handleInput(t){}update(t){this.animate(t);let e=this.getShiftX();this.setX(this.getX()-e)}},dt=class extends _{constructor(t){super(new w(0,0)),this.objectList=[],this.obstacleGeneratingInterval=I.OBSTACLE_GENERATING_INTERVAL,this.setVelocityX(I.GROUND_VELOCITY_X),this.velocityChangingInterval=I.VELOCITY_CHANGING_INTERVAL,this.trex=t}addObject(t){this.objectList.push(t)}removeObject(t){const e=this.objectList.indexOf(t);e>-1&&this.objectList.splice(e,1)}clearObjectList(){this.objectList.length=0}update(t){for(let t=0;t<this.objectList.length;t++)if(this.trex.isColliedWith(this.objectList[t]))return this.getScene().setState("gameover"),this.trex.handleInput(new o(this.getScene().getState())),r.getInstance().startScene(1),void r.getInstance().pauseScene(0);if(this.obstacleGeneratingInterval-t<0){let t=nt(-500,500);this.obstacleGeneratingInterval=I.OBSTACLE_GENERATING_INTERVAL+t,this.obstacleGeneratingInterval=Math.floor(450*this.obstacleGeneratingInterval/this.getVelocityX()),this.spawn()}else this.obstacleGeneratingInterval-=t;this.velocityChangingInterval-t<0?(this.velocityChangingInterval=I.VELOCITY_CHANGING_INTERVAL,this.setVelocityX(this.getVelocityX()+1),this.objectList.forEach((t=>{t.setVelocityX(this.getVelocityX())}))):this.velocityChangingInterval-=t;let e=[];this.objectList.forEach((t=>{(t instanceof A||t instanceof tt)&&t.getX()+t.getWidth()<0&&e.push(t)})),e.forEach((t=>{this.removeObject(t),this.getScene().removeObject(t),t.destroy()}))}spawn(){let t;if(nt(0,9)>=8){let e=nt(0,9);t=new lt(e<=7?I.BIRD_HIGH_CANVAS_LOCATION:I.BIRD_LOW_CANVAS_LOCATION)}else t=new rt(I.CACTUS_CANVAS_LOCATION);t.setVelocityX(this.getVelocityX()),this.addObject(t),this.getScene().addObject(t)}},gt=class extends A{constructor(t){super(t,f.CLOUD_SPRITE.clip),this.setTex(this.resourceManager.getTex(0)),this.setVelocityX(I.CLOUD_VELOCITY_X)}handleInput(t){}update(t){let e=this.getShiftX();this.setX(this.getX()-e)}},ut=class extends _{constructor(){super(new w(0,0)),this.objectList=[],this.cloudGeneratingInterval=I.CLOUD_GENERATING_INTERVAL}addObject(t){this.objectList.push(t)}removeObject(t){const e=this.objectList.indexOf(t);e>-1&&this.objectList.splice(e,1)}clearObjectList(){this.objectList.length=0}update(t){this.cloudGeneratingInterval-t<0?(this.cloudGeneratingInterval=I.CLOUD_GENERATING_INTERVAL,this.spawn()):this.cloudGeneratingInterval-=t;let e=[];this.objectList.forEach((t=>{(t instanceof A||t instanceof tt)&&t.getX()+t.getWidth()<0&&e.push(t)})),e.forEach((t=>{this.removeObject(t),this.getScene().removeObject(t),t.destroy()}))}spawn(){const t=nt(I.CLOUD_LOW_Y,I.CLOUD_HIGH_Y),e=I.CLOUD_CANVAS_LOCATION.copy();e.setY(t);const s=new gt(e);this.addObject(s),this.getScene().addObject(s)}},pt=class extends A{constructor(t){super(t,f.GROUND_SPRITE.clip),this.setTex(this.resourceManager.getTex(0)),this.setVelocityX(I.GROUND_VELOCITY_X)}handleInput(t){}update(t){let e=this.getShiftX();this.setX(this.getX()-e)}},Lt=class extends _{constructor(){super(new w(0,0)),this.objectList=[],this.setVelocityX(I.GROUND_VELOCITY_X),this.velocityChangingInterval=I.VELOCITY_CHANGING_INTERVAL}addObject(t){this.objectList.push(t)}removeObject(t){const e=this.objectList.indexOf(t);e>-1&&this.objectList.splice(e,1)}clearObjectList(){this.objectList.length=0}update(t){this.objectList.forEach((e=>{e.update(t)}));for(let t=0;t<this.objectList.length;t++)if(this.objectList[t].getX()+this.objectList[t].getWidth()<0){let e=new w(this.objectList[t].getX()+3*this.objectList[t].getWidth(),this.objectList[t].getY());const s=new pt(e);s.setVelocityX(this.getVelocityX()),this.addObject(s),this.objectList[t].destroy(),this.removeObject(this.objectList[t]);break}this.velocityChangingInterval-t<0?(this.velocityChangingInterval=I.VELOCITY_CHANGING_INTERVAL,this.setVelocityX(this.getVelocityX()+1),this.objectList.forEach((t=>{t.setVelocityX(this.getVelocityX())}))):this.velocityChangingInterval-=t}render(){this.objectList.forEach((t=>{t.render()}))}setup(){let t,e=I.GROUND_CANVAS_LOCATION.copy();for(let s=0;s<3;s++)t=new pt(e),this.addObject(t),e=new w(e.getX()+t.getWidth(),e.getY())}},wt="play",It=class extends E{constructor(){super(),this.setState("start")}handleInput(t){t.getEvent()==wt&&(this.setState(wt),this.reload())}reload(){this.setState(wt),this.obstacleGroup.setVelocityX(I.GROUND_VELOCITY_X),this.groundGroup.setVelocityX(I.GROUND_VELOCITY_X),this.getObjectList().forEach((t=>{t instanceof it||t instanceof X||t.destroy()})),this.objectList.length=0,this.addObject(this.obstacleGroup),this.obstacleGroup.clearObjectList(),this.addObject(this.cloudGroup),this.cloudGroup.clearObjectList(),this.addObject(this.groundGroup),this.groundGroup.clearObjectList(),this.groundGroup.setup(),this.scoreBoard.reload(),this.scoreBoard.setIsRendered(!0),this.scoreBoard.setIsUpdated(!0),this.addObject(this.scoreBoard),this.trex.handleInput(new o(this.getState())),this.addObject(this.trex)}setup(){this.trex=new it(I.TREX_CANVAS_LOCATION,2),this.addObject(this.trex),this.inputHandler.attachKeyboardEvent(this.trex),this.obstacleGroup=new dt(this.trex),this.cloudGroup=new ut,this.groundGroup=new Lt,this.scoreBoard=new X(I.SCOREBOARD_CANVAS_LOCATION,1),this.scoreBoard.setIsRendered(!1),this.scoreBoard.setIsUpdated(!1),this.addObject(this.scoreBoard)}};(new class extends p{constructor(){super()}setup(){this.resourceManager.loadImage("trex-sprites.png"),this.resourceManager.loadImage("small-red-square.png"),this.physicsManager.setAccelerationX(0),this.physicsManager.setAccelerationY(I.TREX_JUMPING_ACCESSLATION);let t=new It,e=new O;e.stop(),this.sceneManager.addScene(t),this.sceneManager.addScene(e),this.sceneManager.setSceneWidth(1e3),this.sceneManager.setSceneHeight(500),this.inputHandler.addEventListener("keydown"),this.inputHandler.addEventListener("keyup"),this.inputHandler.addEventListener("mousedown"),this.inputHandler.addEventListener("mouseup")}}).run()})();