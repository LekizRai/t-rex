(()=>{"use strict";class t{constructor(t,i){this.sprite={coor:{x:0,y:102},width:2404,height:28,scale:.5},this.canvasLocation={x:t,y:i}}draw(t){this.tex||(this.tex=t.loadImageAndCreateTextureInfo("./assets/images/trex-sprites.png")),t.draw(this.tex,this.sprite.coor.x,this.sprite.coor.y,this.sprite.width,this.sprite.height,this.canvasLocation.x,this.canvasLocation.y,this.sprite.width*this.sprite.scale,this.sprite.height*this.sprite.scale)}update(){this.canvasLocation.x-=5,this.canvasLocation.y-=0}getDisplayLocation(){return this.canvasLocation}getDisplayWidth(){return this.sprite.width*this.sprite.scale}getDisplayHeight(){return this.sprite.height*this.sprite.scale}}class i{constructor(t,i){this.sprite={coor:{x:164,y:0},width:96,height:32,scale:.5},this.canvasLocation={x:t,y:i}}draw(t){this.tex||(this.tex=t.loadImageAndCreateTextureInfo("./assets/images/trex-sprites.png")),t.draw(this.tex,this.sprite.coor.x,this.sprite.coor.y,this.sprite.width,this.sprite.height,this.canvasLocation.x,this.canvasLocation.y,this.sprite.width*this.sprite.scale,this.sprite.height*this.sprite.scale)}update(){this.canvasLocation.x-=2,this.canvasLocation.y-=0}getDisplayLocation(){return this.canvasLocation}getDisplayWidth(){return this.sprite.width*this.sprite.scale}getDisplayHeight(){return this.sprite.height*this.sprite.scale}}class s{constructor(){this.groundList=[],this.groundList.push(new t(0,400));var s=this.groundList[0].getDisplayLocation(),e=Math.ceil(this.groundList[0].getDisplayWidth());this.groundList.push(new t(s.x+e,400)),s=this.groundList[1].getDisplayLocation(),e=Math.ceil(this.groundList[1].getDisplayWidth()),this.groundList.push(new t(s.x+e,400)),this.cloudList=[],this.cloudList.push(new i(1e3,340)),this.lastTime=window.performance.now(),this.period=2e3}draw(t){this.groundList.forEach((i=>{i.draw(t)})),this.cloudList.forEach((i=>{i.draw(t)}))}update(){this.groundList.forEach((t=>{t.update()}));var s=this.groundList[0].getDisplayLocation(),e=Math.ceil(this.groundList[0].getDisplayWidth());s.x+e<0&&(this.groundList.shift(),s=this.groundList[1].getDisplayLocation(),e=Math.ceil(this.groundList[1].getDisplayWidth()),this.groundList.push(new t(s.x+e,400))),this.cloudList.forEach((t=>{t.update()}));var h=window.performance.now();this.cloudList[0].getDisplayLocation().x+this.cloudList[0].getDisplayWidth()<0&&this.cloudList.shift(),h-this.lastTime>this.period&&(this.cloudList.push(new i(1e3,340)),this.lastTime=h)}}class e{constructor(t,i,s){this.sprite=t,this.canvasLocation={x:i,y:s}}isCollided(t){var i,s,e,h;return s={x:(i=this.canvasLocation).x+this.getDisplayWidth(),y:i.y+this.getDisplayHeight()},h={x:(e=t.getDisplayLocation()).x+t.getDisplayWidth(),y:e.y+t.getDisplayHeight()},!(i.x===s.x||i.y===s.y||e.x===h.x||e.y===h.y||-e.x+s.x<5||-i.x+h.x<16||-e.y+s.y<5||-i.y+h.y<16)}}var h={translation:function(t,i,s){return[1,0,0,0,0,1,0,0,0,0,1,0,t,i,s,1]},xRotation:function(t){var i=Math.cos(t),s=Math.sin(t);return[1,0,0,0,0,i,s,0,0,-s,i,0,0,0,0,1]},yRotation:function(t){var i=Math.cos(t),s=Math.sin(t);return[i,0,-s,0,0,1,0,0,s,0,i,0,0,0,0,1]},zRotation:function(t){var i=Math.cos(t),s=Math.sin(t);return[i,s,0,0,-s,i,0,0,0,0,1,0,0,0,0,1]},scaling:function(t,i,s){return[t,0,0,0,0,i,0,0,0,0,s,0,0,0,0,1]},translate:function(t,i,s,e){return h.multiply(t,h.translation(i,s,e))},xRotate:function(t,i){return h.multiply(t,h.xRotation(i))},yRotate:function(t,i){return h.multiply(t,h.yRotation(i))},zRotate:function(t,i){return h.multiply(t,h.zRotation(i))},scale:function(t,i,s,e){return h.multiply(t,h.scaling(i,s,e))},multiply:function(t,i){var s=i[0],e=i[1],h=i[2],r=i[3],a=i[4],o=i[5],n=i[6],c=i[7],g=i[8],l=i[9],d=i[10],u=i[11],p=i[12],x=i[13],w=i[14],m=i[15],y=t[0],L=t[1],f=t[2],v=t[3],T=t[4],R=t[5],A=t[6],E=t[7],_=t[8],D=t[9],b=t[10],F=t[11],S=t[12],B=t[13],C=t[14],I=t[15];return[s*y+e*T+h*_+r*S,s*L+e*R+h*D+r*B,s*f+e*A+h*b+r*C,s*v+e*E+h*F+r*I,a*y+o*T+n*_+c*S,a*L+o*R+n*D+c*B,a*f+o*A+n*b+c*C,a*v+o*E+n*F+c*I,g*y+l*T+d*_+u*S,g*L+l*R+d*D+u*B,g*f+l*A+d*b+u*C,g*v+l*E+d*F+u*I,p*y+x*T+w*_+m*S,p*L+x*R+w*D+m*B,p*f+x*A+w*b+m*C,p*v+x*E+w*F+m*I]},projection:function(t,i,s){return[2/t,0,0,0,0,-2/i,0,0,0,0,2/s,0,-1,1,0,1]},orthographic:function(t,i,s,e,h,r){return[2/(i-t),0,0,0,0,2/(e-s),0,0,0,0,2/(h-r),0,(t+i)/(t-i),(s+e)/(s-e),(h+r)/(h-r),1]}};function r(t,i,s){var e=t.createShader(i);if(t.shaderSource(e,s),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))return e;console.log(t.getShaderInfoLog(e)),t.deleteShader(e)}var a=[];a.push({coor:{x:446,y:2},width:34,height:70,scale:.5}),a.push({coor:{x:480,y:2},width:68,height:70,scale:.5}),a.push({coor:{x:548,y:2},width:102,height:70,scale:.5}),a.push({coor:{x:652,y:2},width:50,height:100,scale:.5}),a.push({coor:{x:702,y:2},width:48,height:100,scale:.5}),a.push({coor:{x:752,y:2},width:98,height:100,scale:.5}),a.push({coor:{x:850,y:2},width:102,height:100,scale:.5});class o extends e{constructor(t,i){var s,e=(s=6-0+1,Math.floor(Math.random()*s+0));super(a[e],t,i)}draw(t){this.tex||(this.tex=t.loadImageAndCreateTextureInfo("./assets/images/trex-sprites.png")),t.draw(this.tex,this.sprite.coor.x,this.sprite.coor.y,this.sprite.width,this.sprite.height,this.canvasLocation.x,this.canvasLocation.y,this.sprite.width*this.sprite.scale,this.sprite.height*this.sprite.scale)}update(){this.canvasLocation.x-=5,this.canvasLocation.y-=0}getDisplayLocation(){return this.canvasLocation}getDisplayWidth(){return this.sprite.width*this.sprite.scale}getDisplayHeight(){return this.sprite.height*this.sprite.scale}}const n=40;var c=[];c.push({coor:{x:1516,y:4},width:84,height:90,scale:.5}),c.push({coor:{x:1604,y:4},width:84,height:90,scale:.5}),c.push({coor:{x:1868,y:38},width:114,height:56,scale:.5}),c.push({coor:{x:1986,y:38},width:114,height:56,scale:.5}),c.push({coor:{x:1340,y:4},width:84,height:90,scale:.5}),c.push({coor:{x:1428,y:4},width:84,height:90,scale:.5}),c.push({coor:{x:1692,y:4},width:84,height:90,scale:.5}),c.push({coor:{x:78,y:6},width:88,height:92,scale:.5});class g{constructor(t,i){this.sprite=c[0],this.canvasLocation={x:t,y:i},this.isDucking=!1,this.isDuckingFirstFrame=!0,this.isJumping=!1,this.jumpingTime=window.performance.now(),this.jumpingPeriod=500,this.addTimes=0,this.isRunningFirstFrame=!0,this.lastTime=window.performance.now(),this.speed=100}draw(t){this.tex||(this.tex=t.loadImageAndCreateTextureInfo("./assets/images/trex-sprites.png")),this.isDucking?this.isDuckingFirstFrame?this.sprite=c[2]:this.sprite=c[3]:this.isJumping?this.sprite=c[4]:this.isRunningFirstFrame?this.sprite=c[0]:this.sprite=c[1],t.draw(this.tex,this.sprite.coor.x,this.sprite.coor.y,this.sprite.width,this.sprite.height,this.canvasLocation.x,this.canvasLocation.y,this.sprite.width*this.sprite.scale,this.sprite.height*this.sprite.scale)}update(){if(this.isDucking)(t=window.performance.now())-this.lastTime>this.speed&&(this.lastTime=t,this.isDuckingFirstFrame=!this.isDuckingFirstFrame);else if(this.isJumping)(t=window.performance.now())-this.jumpingTime>this.jumpingPeriod&&(this.addTimes>1?(this.canvasLocation.y+=4,this.addTimes-=1):this.isJumping=!1),t-this.jumpingTime<this.jumpingPeriod/2?(this.canvasLocation.y-=4,this.addTimes+=1):t-this.jumpingTime>=this.jumpingPeriod/2&&(this.canvasLocation.y+=4,this.addTimes-=1);else{var t;(t=window.performance.now())-this.lastTime>this.speed&&(this.lastTime=t,this.isRunningFirstFrame=!this.isRunningFirstFrame)}}changeState(t){38==t.getKeyCode()||32==t.getKeyCode()?"down"==t.getStatus()&&(this.isJumping=!0,this.jumpingTime=window.performance.now()):t.getKeyCode()==n&&("down"==t.getStatus()?this.isDucking=!0:this.isDucking=!1)}getDisplayLocation(){return this.canvasLocation}getDisplayWidth(){return this.sprite.width*this.sprite.scale}getDisplayHeight(){return this.sprite.height*this.sprite.scale}}var l=[];l.push({coor:{x:952,y:0},width:22,height:26,scale:.5}),l.push({coor:{x:974,y:0},width:20,height:26,scale:.5}),l.push({coor:{x:992,y:0},width:22,height:26,scale:.5}),l.push({coor:{x:1012,y:0},width:22,height:26,scale:.5}),l.push({coor:{x:1032,y:0},width:22,height:26,scale:.5}),l.push({coor:{x:1052,y:0},width:22,height:26,scale:.5}),l.push({coor:{x:1072,y:0},width:22,height:26,scale:.5}),l.push({coor:{x:1092,y:0},width:22,height:26,scale:.5}),l.push({coor:{x:1112,y:0},width:22,height:26,scale:.5}),l.push({coor:{x:1132,y:0},width:22,height:26,scale:.5});var d={coor:{x:1152,y:0},width:42,height:26,scale:.5};class u{constructor(t,i){this.sprite=d,this.canvasLocation={x:t,y:i},this.highPoint=1e3,this.currentPoint=0,this.lastTime=window.performance.now(),this.period=100}draw(t){var i,s;this.tex||(this.tex=t.loadImageAndCreateTextureInfo("./assets/images/trex-sprites.png")),t.draw(this.tex,this.sprite.coor.x,this.sprite.coor.y,this.sprite.width,this.sprite.height,this.canvasLocation.x,this.canvasLocation.y,this.sprite.width*this.sprite.scale,this.sprite.height*this.sprite.scale),i=0,s=30,this.numberToSpriteList(this.highPoint).forEach((e=>{t.draw(this.tex,e.coor.x,e.coor.y,e.width,e.height,this.canvasLocation.x+11*i+s,this.canvasLocation.y,e.width*e.scale,e.height*e.scale),i+=1})),i=0,s=120,this.numberToSpriteList(this.currentPoint).forEach((e=>{t.draw(this.tex,e.coor.x,e.coor.y,e.width,e.height,this.canvasLocation.x+11*i+s,this.canvasLocation.y,e.width*e.scale,e.height*e.scale),i+=1}))}update(){var t=window.performance.now();t-this.lastTime>this.period&&(this.currentPoint+=1,this.lastTime=t)}numberToSpriteList(t){for(var i,s=[],e=4;e>-1;e--)i=Math.floor(t/10**e),t%=10**e,s.push(l[i]);return s}}class p{constructor(t){console.log(t),this.gl=t.getContext("webgl"),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND),this.gl.viewport(100,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.vertexSource="\nattribute vec4 a_position;\nattribute vec2 a_texcoord;\n\nuniform mat4 u_matrix;\nuniform mat4 u_textureMatrix;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    gl_Position = u_matrix * a_position;\n    v_texcoord = (u_textureMatrix * vec4(a_texcoord, 0, 1)).xy;\n}\n",this.fragmentSource="\nprecision mediump float;\n\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\n\nvoid main() {\n    gl_FragColor = texture2D(u_texture, v_texcoord);\n}\n";var i=r(this.gl,this.gl.VERTEX_SHADER,this.vertexSource),s=r(this.gl,this.gl.FRAGMENT_SHADER,this.fragmentSource);this.program=function(t,i,s){var e=t.createProgram();if(t.attachShader(e,i),t.attachShader(e,s),t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS))return e;console.log(t.getProgramInfoLog(e)),t.deleteProgram(e)}(this.gl,i,s),this.positionLocation=this.gl.getAttribLocation(this.program,"a_position"),this.texcoordLocation=this.gl.getAttribLocation(this.program,"a_texcoord"),this.matrixLocation=this.gl.getUniformLocation(this.program,"u_matrix"),this.textureMatrixLocation=this.gl.getUniformLocation(this.program,"u_textureMatrix"),this.textureLocation=this.gl.getUniformLocation(this.program,"u_texture"),this.positionBuffer=this.gl.createBuffer(),this.texcoordBuffer=this.gl.createBuffer()}loadImageAndCreateTextureInfo(t){var i=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR);var s={width:1,height:1,texture:i},e=new Image;return e.addEventListener("load",(t=>{s.width=e.width,s.height=e.height,this.gl&&(this.gl.bindTexture(this.gl.TEXTURE_2D,s.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e))})),e.src=t,s}draw(t,i,s,e,h,r,a,o,n){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),this.gl.STATIC_DRAW);var c={x:110,y:110,dx:1,dy:1,textureInfo:t};this.gl&&this.drawImage(c.textureInfo.texture,c.textureInfo.width,c.textureInfo.height,i,s,e,h,r,a,o,n)}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}drawImage(t,i,s,e,r,a,o,n,c,g,l){if(this.gl){this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),this.gl.enableVertexAttribArray(this.texcoordLocation),this.gl.vertexAttribPointer(this.texcoordLocation,2,this.gl.FLOAT,!1,0,0);var d=h.orthographic(0,this.gl.canvas.width,this.gl.canvas.height,0,-1,1);d=h.translate(d,n,c,0),d=h.scale(d,g,l,1),this.gl.uniformMatrix4fv(this.matrixLocation,!1,d);var u=h.translation(e/i,r/s,0);u=h.scale(u,a/i,o/s,1),this.gl.uniformMatrix4fv(this.textureMatrixLocation,!1,u),this.gl.uniform1i(this.textureLocation,0),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}}drawPolygons(t,i){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.viewport(0,0,window.innerWidth,window.innerHeight),this.gl.useProgram(this.program),this.gl.uniform2f(this.resolutionUniformLocation,window.innerWidth,window.innerHeight),this.gl.uniform4f(this.colorUniformLocation,1,0,i,1),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.drawArrays(this.gl.TRIANGLES,0,3)}}class x{constructor(){this.canvas=document.createElement("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.drawer=new p(this.canvas),this.background=new s,this.obstacleList=[],this.obstacleList.push(new o(1e3,365)),this.trex=new g(50,370),this.pointBoard=new u(500,300),this.lastTime=window.performance.now(),this.period=1500}update(){this.background.update(),this.obstacleList.forEach((t=>{t.update()}));var t=window.performance.now();this.obstacleList.length>0&&this.obstacleList[0].getDisplayLocation().x+this.obstacleList[0].getDisplayWidth()<0&&this.obstacleList.shift(),t-this.lastTime>this.period&&(this.obstacleList.push(new o(1e3,365)),this.lastTime=t),this.trex.update(),this.pointBoard.update()}checkCollision(){for(var t of this.obstacleList)if(t.isCollided(this.trex))return!0;return!1}render(){this.drawer.clear(),this.background.draw(this.drawer),this.obstacleList.forEach((t=>{t.draw(this.drawer)})),this.trex.draw(this.drawer),this.pointBoard.draw(this.drawer),document.body.appendChild(this.canvas)}getTRex(){return this.trex}}class w{construtor(){}getKeyCode(){return this.keyCode}getStatus(){return this.status}setKeyCode(t){this.keyCode=t}setStatus(t){this.status=t}}class m{constructor(t){this.stateHandler=t,this.message=new w}init(){document.addEventListener("keydown",(t=>{switch(t.keyCode){case n:this.message.setKeyCode(n),this.message.setStatus("down"),console.log(n);break;case 38:this.message.setKeyCode(38),this.message.setStatus("down"),console.log(38);break;case 32:this.message.setKeyCode(32),this.message.setStatus("down"),console.log(32);break;case 80:this.message.setKeyCode(80),this.message.setStatus("down"),console.log(80)}this.stateHandler.notify(this.message)})),document.addEventListener("keyup",(t=>{t.keyCode===n&&(this.message.setKeyCode(n),this.message.setStatus("up"),console.log(n)),this.stateHandler.notify(this.message)}))}}class y{constructor(){this.subcriberList=[]}register(t){this.subcriberList.push(t)}notify(t){this.subcriberList.forEach((i=>{i.changeState(t)}))}}(new class{constructor(){this.canvaView=new x,this.stateHandler=new y,this.stateHandler.register(this.canvaView.getTRex()),this.inputHandler=new m(this.stateHandler),this.inputHandler.init(),this.endGame=!1}update(){this.canvaView.update(),this.endGame=this.canvaView.checkCollision()}render(){this.canvaView.render()}loop(){this.endGame||(this.update(),this.render(),requestAnimationFrame((()=>this.loop())))}run(){requestAnimationFrame((()=>this.loop()))}}).run()})();