(()=>{"use strict";const t=class{constructor(){this.lastTime=window.performance.now()}update(){let t=window.performance.now();this.physicsManager.update(t-this.lastTime),this.scene.update(t-this.lastTime),this.lastTime=t,this.scene.synchronize()}render(){this.scene.render()}run(){this.update(),this.render(),requestAnimationFrame((()=>this.run()))}},e=class{constructor(t){this.scene=t}addEventListener(t){document.addEventListener(t,(t=>{t.preventDefault(),this.scene.handleInput(t)}),!1)}},i=class{constructor(){this.rigidBodyList=[]}setAccelerationX(t){this.accelerationX=t}setAccelerationY(t){this.accelerationY=t}addRigidBodyList(t){this.rigidBodyList.push(t)}update(t){let e=t/1e3;this.rigidBodyList.forEach((t=>{t.getAccelerationEffect()?(t.setShiftX(Math.floor(.5*this.accelerationX*e*e+t.getVelocityX()*e)),t.setShiftY(Math.floor(.5*this.accelerationY*e*e+t.getVelocityY()*e)),t.setVelocityX(Math.floor(t.getVelocityX()+this.accelerationX*e)),t.setVelocityY(Math.floor(t.getVelocityY()+this.accelerationY*e))):(t.setShiftX(Math.floor(t.getVelocityX()*e)),t.setShiftY(Math.floor(t.getVelocityY()*e)))}))}};class s{constructor(t,e){this.x=t,this.y=e}getX(){return this.x}setX(t){this.x=t}getY(){return this.y}setY(t){this.y=t}add(t){let e=new s(0,0);return e.setX(this.x+t.getX()),e.setY(this.y+t.getY()),e}copy(){return new s(this.x,this.y)}}const n=s,h={TREX_VELOCITY_X:0,TREX_VELOCITY_Y:0,TREX_JUMPING_VELOCITY:900,TREX_JUMPING_ACCESSLATION:-5e3,TREX_CANVAS_LOCATION:new n(200,368),TREX_CHANGING_INTERVAL:100,CACTUS_VELOCITY_X:500,CACTUS_VELOCITY_Y:0,CACTUS_CANVAS_LOCATION:new n(1500,365),CACTUS_GENERATING_INTERVAL:2e3,GROUND_VELOCITY_X:500,GROUND_VELOCITY_Y:0,GROUND_CANVAS_LOCATION:new n(0,400),CLOUD_VELOCITY_X:200,CLOUD_VELOCITY_Y:0,CLOUD_CANVAS_LOCATION:new n(1500,340),CLOUD_GENERATING_INTERVAL:2e3,CLOUD_LOW_Y:270,CLOUD_HIGH_Y:340,BIRD_VELOCITY_X:0,BIRD_VELOCITY_Y:0,BIRD_CANVAS_LOCATION:new n(0,0),BIRD_CHANGING_INTERVAL:1e3,SCOREBOARD_CANVAS_LOCATION:new n(1e3,250),SCOREBOARD_SCORE_CHANGING_INTERVAL:100},r={multiply:function(t,e){let i=t[0],s=t[1],n=t[2],h=t[3],r=t[4],o=t[5],a=t[6],c=t[7],l=t[8],d=e[0],g=e[1],u=e[2],p=e[3],_=e[4],L=e[5],T=e[6],E=e[7],w=e[8];return[d*i+g*h+u*a,d*s+g*r+u*c,d*n+g*o+u*l,p*i+_*h+L*a,p*s+_*r+L*c,p*n+_*o+L*l,T*i+E*h+w*a,T*s+E*r+w*c,T*n+E*o+w*l]},translation:function(t,e){return[1,0,0,0,1,0,t,e,1]},rotation:function(t){let e=Math.cos(t),i=Math.sin(t);return[e,-i,0,i,e,0,0,0,1]},scaling:function(t,e){return[t,0,0,0,e,0,0,0,1]},projection:function(t,e){return[2/t,0,0,0,-2/e,0,-1,1,1]},translate:function(t,e,i){return r.multiply(t,r.translation(e,i))},rotate:function(t,e){return r.multiply(t,r.rotation(e))},scale:function(t,e,i){return r.multiply(t,r.scaling(e,i))}},o={translation:function(t,e,i){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1]},xRotation:function(t){let e=Math.cos(t),i=Math.sin(t);return[1,0,0,0,0,e,i,0,0,-i,e,0,0,0,0,1]},yRotation:function(t){let e=Math.cos(t),i=Math.sin(t);return[e,0,-i,0,0,1,0,0,i,0,e,0,0,0,0,1]},zRotation:function(t){let e=Math.cos(t),i=Math.sin(t);return[e,i,0,0,-i,e,0,0,0,0,1,0,0,0,0,1]},scaling:function(t,e,i){return[t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1]},translate:function(t,e,i,s){return o.multiply(t,o.translation(e,i,s))},xRotate:function(t,e){return o.multiply(t,o.xRotation(e))},yRotate:function(t,e){return o.multiply(t,o.yRotation(e))},zRotate:function(t,e){return o.multiply(t,o.zRotation(e))},scale:function(t,e,i,s){return o.multiply(t,o.scaling(e,i,s))},multiply:function(t,e){let i=e[0],s=e[1],n=e[2],h=e[3],r=e[4],o=e[5],a=e[6],c=e[7],l=e[8],d=e[9],g=e[10],u=e[11],p=e[12],_=e[13],L=e[14],T=e[15],E=t[0],w=t[1],A=t[2],R=t[3],f=t[4],I=t[5],S=t[6],x=t[7],C=t[8],y=t[9],O=t[10],m=t[11],N=t[12],X=t[13],Y=t[14],v=t[15];return[i*E+s*f+n*C+h*N,i*w+s*I+n*y+h*X,i*A+s*S+n*O+h*Y,i*R+s*x+n*m+h*v,r*E+o*f+a*C+c*N,r*w+o*I+a*y+c*X,r*A+o*S+a*O+c*Y,r*R+o*x+a*m+c*v,l*E+d*f+g*C+u*N,l*w+d*I+g*y+u*X,l*A+d*S+g*O+u*Y,l*R+d*x+g*m+u*v,p*E+_*f+L*C+T*N,p*w+_*I+L*y+T*X,p*A+_*S+L*O+T*Y,p*R+_*x+L*m+T*v]},projection:function(t,e,i){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/i,0,-1,1,0,1]},orthographic:function(t,e,i,s,n,h){return[2/(e-t),0,0,0,0,2/(s-i),0,0,0,0,2/(n-h),0,(t+e)/(t-e),(i+s)/(i-s),(n+h)/(n-h),1]}},a={m3:r,m4:o,createShader:function(t,e,i){const s=t.createShader(e);if(s){if(t.shaderSource(s,i),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS))return s;console.log(t.getShaderInfoLog(s)),t.deleteShader(s)}},createProgram:function(t,e,i){const s=t.createProgram();if(s){if(t.attachShader(s,e),t.attachShader(s,i),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS))return s;console.log(t.getProgramInfoLog(s)),t.deleteProgram(s)}},randomInt:function(t,e){let i=e-t+1;return Math.floor(Math.random()*i+t)}},c=class{constructor(t){this.gl=t.getContext("webgl"),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.vertexSource="\nattribute vec4 a_position;\nattribute vec2 a_texcoord;\n\nuniform mat4 u_matrix;\nuniform mat4 u_textureMatrix;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    gl_Position = u_matrix * a_position;\n    v_texcoord = (u_textureMatrix * vec4(a_texcoord, 0, 1)).xy;\n}\n",this.fragmentSource="\nprecision mediump float;\n\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\n\nvoid main() {\n    gl_FragColor = texture2D(u_texture, v_texcoord);\n}\n";let e=a.createShader(this.gl,this.gl.VERTEX_SHADER,this.vertexSource),i=a.createShader(this.gl,this.gl.FRAGMENT_SHADER,this.fragmentSource);if(e&&i){const t=a.createProgram(this.gl,e,i);t&&(this.program=t)}this.positionLocation=this.gl.getAttribLocation(this.program,"a_position"),this.texcoordLocation=this.gl.getAttribLocation(this.program,"a_texcoord"),this.matrixLocation=this.gl.getUniformLocation(this.program,"u_matrix"),this.textureMatrixLocation=this.gl.getUniformLocation(this.program,"u_textureMatrix"),this.textureLocation=this.gl.getUniformLocation(this.program,"u_texture"),this.positionBuffer=this.gl.createBuffer(),this.texcoordBuffer=this.gl.createBuffer()}loadImageAndCreateTextureInfo(t){const e=this.gl.createTexture();if(e){this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR);let i={width:1,height:1,texture:e},s=new Image;return s.addEventListener("load",(t=>{i.width=s.width,i.height=s.height,this.gl&&(this.gl.bindTexture(this.gl.TEXTURE_2D,i.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,s))})),s.src=t,i}}draw(t,e,i,s,n,h,r,o,a){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),this.gl.STATIC_DRAW);let c={x:110,y:110,dx:1,dy:1,textureInfo:t};this.gl&&this.drawImage(c.textureInfo.texture,c.textureInfo.width,c.textureInfo.height,e,i,s,n,h,r,o,a)}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}drawImage(t,e,i,s,n,h,r,o,c,l,d){if(this.gl){this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),this.gl.enableVertexAttribArray(this.texcoordLocation),this.gl.vertexAttribPointer(this.texcoordLocation,2,this.gl.FLOAT,!1,0,0);let g=a.m4.orthographic(0,this.gl.canvas.width,this.gl.canvas.height,0,-1,1);g=a.m4.translate(g,o,c,0),g=a.m4.scale(g,l,d,1),this.gl.uniformMatrix4fv(this.matrixLocation,!1,g);let u=a.m4.translation(s/e,n/i,0);u=a.m4.scale(u,h/e,r/i,1),this.gl.uniformMatrix4fv(this.textureMatrixLocation,!1,u),this.gl.uniform1i(this.textureLocation,0),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}}drawPolygons(t,e){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.viewport(0,0,window.innerWidth,window.innerHeight),this.gl.useProgram(this.program),this.gl.uniform2f(this.resolutionUniformLocation,window.innerWidth,window.innerHeight),this.gl.uniform4f(this.colorUniformLocation,1,0,e,1),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.drawArrays(this.gl.TRIANGLES,0,3)}},l=class{constructor(){this.canvas=document.createElement("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.drawer=new c(this.canvas),this.objectList=[],this.toAddObjectList=[],this.toRemoveObjectList=[]}render(){this.drawer.clear(),this.objectList.forEach((t=>{t.draw(this.drawer)})),document.body.appendChild(this.canvas)}synchronize(){let t;this.toAddObjectList.forEach((t=>{this.objectList.push(t)})),this.toAddObjectList.length=0,this.toRemoveObjectList.forEach((e=>{t=this.objectList.indexOf(e),t>-1&&this.objectList.splice(t,1)})),this.toRemoveObjectList.length=0}addObject(t){this.toAddObjectList.push(t)}removeObject(t){this.toRemoveObjectList.push(t)}},d={CLOUD_SPRITE:{clip:{coor:{x:164,y:0},width:96,height:32,scale:.5},adjust:new n(0,0)},BIRD_SPRITE:[{clip:{coor:{x:262,y:16},width:88,height:64,scale:.5},adjust:new n(0,0)},{clip:{coor:{x:354,y:4},width:88,height:56,scale:.5},adjust:new n(0,0)}],CACTUS_SPRITES:[{clip:{coor:{x:446,y:2},width:34,height:70,scale:.5},adjust:new n(0,14)},{clip:{coor:{x:480,y:2},width:68,height:70,scale:.5},adjust:new n(0,14)},{clip:{coor:{x:548,y:2},width:102,height:70,scale:.5},adjust:new n(0,14)},{clip:{coor:{x:652,y:2},width:50,height:100,scale:.5},adjust:new n(0,0)},{clip:{coor:{x:702,y:2},width:48,height:100,scale:.5},adjust:new n(0,0)},{clip:{coor:{x:752,y:2},width:98,height:100,scale:.5},adjust:new n(0,0)},{clip:{coor:{x:850,y:2},width:102,height:100,scale:.5},adjust:new n(0,0)}],TREX_SPRITES:[{clip:{coor:{x:1516,y:4},width:84,height:90,scale:.5},adjust:new n(0,0)},{clip:{coor:{x:1604,y:4},width:84,height:90,scale:.5},adjust:new n(0,0)},{clip:{coor:{x:1868,y:38},width:114,height:56,scale:.5},adjust:new n(0,16)},{clip:{coor:{x:1986,y:38},width:114,height:56,scale:.5},adjust:new n(0,16)},{clip:{coor:{x:1340,y:4},width:84,height:90,scale:.5},adjust:new n(0,0)},{clip:{coor:{x:1428,y:4},width:84,height:90,scale:.5},adjust:new n(0,0)},{clip:{coor:{x:1692,y:4},width:84,height:90,scale:.5},adjust:new n(0,0)},{clip:{coor:{x:78,y:6},width:88,height:92,scale:.5},adjust:new n(0,0)}],GROUND_SPRITE:{clip:{coor:{x:0,y:102},width:2404,height:28,scale:.5},adjust:new n(0,0)},NUMBER_SPRITES:{0:{clip:{coor:{x:952,y:0},width:22,height:26,scale:.5},adjust:new n(0,0)},1:{clip:{coor:{x:974,y:0},width:20,height:26,scale:.5},adjust:new n(0,0)},2:{clip:{coor:{x:992,y:0},width:22,height:26,scale:.5},adjust:new n(0,0)},3:{clip:{coor:{x:1012,y:0},width:22,height:26,scale:.5},adjust:new n(0,0)},4:{clip:{coor:{x:1032,y:0},width:22,height:26,scale:.5},adjust:new n(0,0)},5:{clip:{coor:{x:1052,y:0},width:22,height:26,scale:.5},adjust:new n(0,0)},6:{clip:{coor:{x:1072,y:0},width:22,height:26,scale:.5},adjust:new n(0,0)},7:{clip:{coor:{x:1092,y:0},width:22,height:26,scale:.5},adjust:new n(0,0)},8:{clip:{coor:{x:1112,y:0},width:22,height:26,scale:.5},adjust:new n(0,0)},9:{clip:{coor:{x:1132,y:0},width:22,height:26,scale:.5},adjust:new n(0,0)}},HI_SPRITE:{clip:{coor:{x:1152,y:0},width:42,height:26,scale:.5},adjust:new n(0,0)},GAMEOVER_SPRITE:{clip:{coor:{x:952,y:28},width:384,height:24,scale:.75},adjust:new n(0,0)},PLAY_BUTTON_SPRITE:{clip:{coor:{x:2,y:2},width:72,height:64,scale:.5},adjust:new n(0,0)}},g=class{constructor(t,e,i){this.velocityX=t,this.velocityY=e,this.shiftX=0,this.shiftY=0,this.accelerationEffect=!1,this.mass=i}getVelocityX(){return this.velocityX}getVelocityY(){return this.velocityY}setVelocityX(t){this.velocityX=t}setVelocityY(t){this.velocityY=t}getMass(){return this.mass}setMass(t){this.mass=t}getAccelerationEffect(){return this.accelerationEffect}setAccelerationEffect(t){this.accelerationEffect=t}getShiftX(){return this.shiftX}setShiftX(t){this.shiftX=t}getShiftY(){return this.shiftY}setShiftY(t){this.shiftY=t}},u=class{constructor(t){this.location=t,this.colliderList=[],this.rigidBody=new g(0,0,0)}getLocation(){return this.location}setColliderList(t){this.colliderList=t}setRigidBody(t){this.rigidBody=t}isCollied(t){for(let e=0;e<this.colliderList.length;e++)for(let i=0;i<t.colliderList.length;i++){let s,h,r,o;if(s=this.colliderList[e].getOrigin(),s=s.add(this.location),h=new n(s.getX()+this.colliderList[e].getWidth(),s.getY()+this.colliderList[e].getHeight()),r=t.colliderList[i].getOrigin(),r=r.add(t.location),o=new n(r.getX()+t.colliderList[i].getWidth(),r.getY()+t.colliderList[i].getHeight()),s.getX()!==h.getX()&&s.getY()!==h.getY()&&r.getX()!==o.getX()&&r.getY()!==o.getY()&&!(h.getX()-r.getX()<0||o.getX()-s.getX()<0||h.getY()-r.getY()<0||o.getY()-s.getY()<0))return!0}return!1}},p=class extends u{constructor(t,e){super(t),this.sprite=e}draw(t){if(!this.tex){const e=t.loadImageAndCreateTextureInfo("./assets/images/trex-sprites.png");e&&(this.tex=e)}t.draw(this.tex,this.sprite.coor.x,this.sprite.coor.y,this.sprite.width,this.sprite.height,this.location.getX(),this.location.getY(),this.sprite.width*this.sprite.scale,this.sprite.height*this.sprite.scale)}setSprite(t){this.sprite=t}getWidth(){return this.sprite.width*this.sprite.scale}getHeight(){return this.sprite.height*this.sprite.scale}},_=class{constructor(t,e,i){this.origin=t,this.width=e,this.height=i}getOrigin(){return this.origin}getWidth(){return this.width}getHeight(){return this.height}setOrigin(t){this.origin=t}setWidth(t){this.width=t}setHeight(t){this.height=t}},L=class extends p{constructor(t,e){let i=a.randomInt(0,6);super(e.add(d.CACTUS_SPRITES[i].adjust),d.CACTUS_SPRITES[i].clip),this.setColliderList([new _(new n(0,0),this.getWidth(),this.getHeight())]),this.setRigidBody(new g(h.CACTUS_VELOCITY_X,h.CACTUS_VELOCITY_Y,0)),this.scene=t}handleInput(t){}update(t){let e=Math.floor(t/1e3*h.CACTUS_VELOCITY_X);this.location.setX(this.location.getX()-e),this.location.getX()+this.getWidth()<0&&this.scene.removeObject(this)}},T=class{constructor(t){this.scene=t}},E=class extends T{constructor(t){super(t)}spawn(){this.scene.addObject(new L(this.scene,h.CACTUS_CANVAS_LOCATION))}},w=class extends p{constructor(t,e){super(e,d.CLOUD_SPRITE.clip),this.scene=t}handleInput(t){}update(t){let e=Math.floor(t/1e3*h.CLOUD_VELOCITY_X);this.location.setX(this.location.getX()-e),this.location.getX()+this.getWidth()<0&&this.scene.removeObject(this)}},A=class extends T{constructor(t){super(t)}spawn(){this.scene.addObject(new w(this.scene,h.CLOUD_CANVAS_LOCATION))}},R=class extends u{constructor(t){super(t),this.spriteList=[],this.content="",this.letterGap=1}draw(t){this.tex||(this.tex=t.loadImageAndCreateTextureInfo("./assets/images/trex-sprites.png"));let e=0;this.spriteList.forEach((i=>{t.draw(this.tex,i.coor.x,i.coor.y,i.width,i.height,this.location.getX()+e,this.location.getY(),i.width*i.scale,i.height*i.scale),e+=i.width*i.scale+this.letterGap}))}getContent(){return this.content}setContent(t){this.content=t,this.contentToSpriteList()}},f=class extends R{constructor(){super(new n(550,250)),this.setContent("GAMEOVER")}handleInput(t){}update(t){}contentToSpriteList(){this.spriteList.length=0,this.spriteList.push(d.GAMEOVER_SPRITE.clip)}},I=class extends p{constructor(t){super(t,d.PLAY_BUTTON_SPRITE.clip)}handleInput(t){}update(t){}};class S extends p{constructor(t,e){super(e,d.GROUND_SPRITE.clip),this.scene=t}handleInput(t){}update(t){let e=Math.floor(t/1e3*h.GROUND_VELOCITY_X);if(this.location.setX(this.location.getX()-e),this.location.getX()+this.getWidth()<0){let t=new n(this.location.getX()+3*this.getWidth(),this.location.getY());this.scene.addObject(new S(this.scene,t)),this.scene.removeObject(this)}}}const x=S,C=class extends R{constructor(t){super(new n(1080,260)),this.setContent("00000"),this.changingInterval=t}handleInput(t){}update(t){if(this.changingInterval-t<0){this.changingInterval=h.SCOREBOARD_SCORE_CHANGING_INTERVAL;let t=Number(this.getContent());t+=1;let e,i="";for(let s=4;s>-1;s--)e=Math.floor(t/10**s),t%=10**s,i+=String(e);this.setContent(i)}else this.changingInterval-=t}reload(){this.setContent("00000")}contentToSpriteList(){this.spriteList.length=0;for(let t=0;t<this.content.length;t++)this.spriteList.push(d.NUMBER_SPRITES[this.content[t]].clip)}},y=class extends R{constructor(){super(new n(985,260)),this.setContent("00000")}handleInput(t){}update(t){}reload(){const t=window.localStorage.getItem("high_score");t?this.setContent(t):this.setContent("00000")}contentToSpriteList(){this.spriteList.length=0;for(let t=0;t<this.content.length;t++)this.spriteList.push(d.NUMBER_SPRITES[this.content[t]].clip)}},O=class extends R{constructor(){super(new n(950,260)),this.setContent("HI")}handleInput(t){}update(t){}contentToSpriteList(){this.spriteList.length=0,this.spriteList.push(d.HI_SPRITE.clip)}},m=class extends u{constructor(t){super(t),this.highPoint=new y,this.currentPoint=new C(h.SCOREBOARD_SCORE_CHANGING_INTERVAL),this.HI=new O}handleInput(t){}update(t){this.highPoint.update(t),this.currentPoint.update(t),this.HI.update(t),this.updateHighScore()}draw(t){this.highPoint.draw(t),this.currentPoint.draw(t),this.HI.draw(t)}reload(){this.highPoint.reload(),this.currentPoint.reload()}updateHighScore(){Number(this.highPoint.getContent())<Number(this.currentPoint.getContent())&&window.localStorage.setItem("high_score",this.currentPoint.getContent())}},N=40,X=38,Y=32,v=class{constructor(){}},U=[d.TREX_SPRITES[0].clip,d.TREX_SPRITES[1].clip],V=[d.TREX_SPRITES[2].clip,d.TREX_SPRITES[3].clip],j=[d.TREX_SPRITES[4].clip];class B extends v{constructor(){super()}handleInput(t,e){if(e instanceof KeyboardEvent&&"keydown"==e.type)if(e.keyCode==N){t.setSpriteList(V);let e=h.TREX_CANVAS_LOCATION.add(d.TREX_SPRITES[2].adjust);t.setDisplayLocation(e),t.setState(new b)}else e.keyCode!=Y&&e.keyCode!=X||e.repeat||(t.setSpriteList(j),t.setState(new P),t.setVelocityY(h.TREX_JUMPING_VELOCITY),t.setAccelerationEffect(!0))}update(t,e){t.animate(e)}}class b extends v{constructor(){super()}handleInput(t,e){if(e instanceof KeyboardEvent&&e.keyCode==N&&"keyup"==e.type){t.setSpriteList(U);let e=h.TREX_CANVAS_LOCATION.add(d.TREX_SPRITES[0].adjust);t.setDisplayLocation(e),t.setState(new B)}}update(t,e){t.animate(e)}}class P extends v{constructor(){super()}handleInput(t,e){}update(t,e){t.animate(e);let i=t.getShiftY(),s=t.getLocation().copy();s.getY()-i>370||s.getY()<0?(s.setY(370),t.setSpriteList(U),t.setDisplayLocation(s),t.setVelocityY(0),t.setAccelerationEffect(!1),t.setState(new B)):(s.setY(s.getY()-i),t.setDisplayLocation(s))}}const G={TRexDuckingState:b,TRexGameOverState:class extends v{constructor(){super()}handleInput(t,e){}update(t,e){t.animate(e)}},TRexJumpingState:P,TRexRunningState:B},D=class extends u{constructor(t,e,i){super(t),this.spriteList=i,this.changingInterval=e,this.remainingInterval=this.changingInterval,this.index=0}animate(t){this.spriteList.length>0&&(this.remainingInterval<0?(this.remainingInterval=this.changingInterval,this.index=(this.index+1)%this.spriteList.length):this.remainingInterval-=t)}draw(t){if(!this.tex){const e=t.loadImageAndCreateTextureInfo("./assets/images/trex-sprites.png");e&&(this.tex=e)}this.spriteList.length>0&&t.draw(this.tex,this.spriteList[this.index].coor.x,this.spriteList[this.index].coor.y,this.spriteList[this.index].width,this.spriteList[this.index].height,this.location.getX(),this.location.getY(),this.spriteList[this.index].width*this.spriteList[this.index].scale,this.spriteList[this.index].height*this.spriteList[this.index].scale)}setSpriteList(t){this.index=0,this.spriteList=t}getCurrentSprite(){return this.spriteList[this.index]}getWidth(){return this.spriteList[this.index].width*this.spriteList[this.index].scale}getHeight(){return this.spriteList[this.index].height*this.spriteList[this.index].scale}},M=[d.TREX_SPRITES[0].clip,d.TREX_SPRITES[1].clip],H=class extends D{constructor(t,e){super(e,h.TREX_CHANGING_INTERVAL,M),this.physicsManager=t,this.setColliderList([new _(new n(0,0),this.getWidth(),this.getHeight())]),this.setRigidBody(new g(h.TREX_VELOCITY_X,h.TREX_VELOCITY_Y,0)),this.rigidBody.setAccelerationEffect(!1),this.physicsManager.addRigidBodyList(this.rigidBody),this.state=new G.TRexRunningState}handleInput(t){this.state.handleInput(this,t)}update(t){this.state.update(this,t)}setDisplayLocation(t){this.location=t}setState(t){this.state=t}getVelocityX(){return this.rigidBody.getVelocityX()}setVelocityX(t){this.rigidBody.setVelocityX(t)}getVelocityY(){return this.rigidBody.getVelocityY()}setVelocityY(t){this.rigidBody.setVelocityY(t)}getShiftX(){return this.rigidBody.getShiftX()}getShiftY(){return this.rigidBody.getShiftY()}getSprite(){return this.getCurrentSprite()}setAccelerationEffect(t){this.rigidBody.setAccelerationEffect(t)}},F="play",W="gameover",k=class extends l{constructor(t){super(),this.physicsManager=t,this.sceneState=F,this.mouseStatus="down"}handleInput(t){if(this.sceneState==F)this.objectList.forEach((e=>{e.handleInput(t)}));else if(this.sceneState==W&&t instanceof MouseEvent){let e=this.replayButton.getLocation();t.x>=e.getX()&&t.y>=e.getY()&&t.x<=e.getX()+this.replayButton.getWidth()&&t.y<=e.getY()+this.replayButton.getHeight()?"mousedown"==t.type?"down"==this.mouseStatus&&(this.mouseStatus="up"):"mouseup"==t.type&&"up"==this.mouseStatus&&(this.sceneState=F,this.reload()):this.mouseStatus="down"}}update(t){if(this.sceneState==F){this.objectList.forEach((e=>{e.update(t)})),this.cactusGeneratingInterval-t<0?(this.cactusGeneratingInterval=h.CACTUS_GENERATING_INTERVAL,this.cactusManager.spawn()):this.cactusGeneratingInterval-=t,this.cloudGeneratingInterval-t<0?(this.cloudGeneratingInterval=h.CLOUD_GENERATING_INTERVAL,this.cloudManager.spawn()):this.cloudGeneratingInterval-=t;for(let t=0;t<this.objectList.length;t++)if(this.objectList[t]instanceof H){for(let e=0;e<this.objectList.length;e++)if(this.objectList[e]instanceof L&&this.objectList[t].isCollied(this.objectList[e])){this.sceneState=W,this.addObject(this.gameOver),this.addObject(this.replayButton);break}break}}}reload(){this.objectList.length=0,this.cactusGeneratingInterval=h.CACTUS_GENERATING_INTERVAL,this.cloudGeneratingInterval=h.CLOUD_GENERATING_INTERVAL,this.addObject(new L(this,h.CACTUS_CANVAS_LOCATION)),this.addObject(new w(this,h.CLOUD_CANVAS_LOCATION));let t,e=h.GROUND_CANVAS_LOCATION.copy();for(let i=0;i<3;i++)t=new x(this,e),this.addObject(t),e=new n(e.getX()+t.getWidth(),e.getY());this.scoreBoard.reload(),this.addObject(this.scoreBoard),this.addObject(new H(this.physicsManager,h.TREX_CANVAS_LOCATION))}setup(){this.cactusManager=new E(this),this.cactusGeneratingInterval=h.CACTUS_GENERATING_INTERVAL,this.cloudManager=new A(this),this.cloudGeneratingInterval=h.CLOUD_GENERATING_INTERVAL,this.gameOver=new f,this.replayButton=new I(new n(680,300)),this.scoreBoard=new m(h.SCOREBOARD_CANVAS_LOCATION),this.addObject(new L(this,h.CACTUS_CANVAS_LOCATION)),this.addObject(new w(this,h.CLOUD_CANVAS_LOCATION));let t,e=h.GROUND_CANVAS_LOCATION;for(let i=0;i<3;i++)t=new x(this,e),this.addObject(t),e=new n(e.getX()+t.getWidth(),e.getY());this.addObject(this.scoreBoard),this.addObject(new H(this.physicsManager,h.TREX_CANVAS_LOCATION))}};let z=new class extends t{constructor(){super()}setup(){this.physicsManager=new i,this.physicsManager.setAccelerationX(0),this.physicsManager.setAccelerationY(h.TREX_JUMPING_ACCESSLATION),this.scene=new k(this.physicsManager),this.scene.setup(),this.inputHandler=new e(this.scene),this.inputHandler.addEventListener("keydown"),this.inputHandler.addEventListener("keyup"),this.inputHandler.addEventListener("mousedown"),this.inputHandler.addEventListener("mouseup")}};z.setup(),z.run()})();